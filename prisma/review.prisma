// Review and Comment enums
enum ReviewableType {
    product
    service
    shop
}

enum CommentableType {
    post
    product
    service
}

// Review Model
model Review {
    id                 String         @id @default(uuid())
    userId             String         @map("user_id")
    reviewableType     ReviewableType @map("reviewable_type")
    reviewableId       String         @map("reviewable_id")
    rating             Int
    title              String?
    comment            String?
    images             Json?
    isVerifiedPurchase Boolean        @default(false) @map("is_verified_purchase")
    helpfulCount       Int            @default(0) @map("helpful_count")
    deletedAt          DateTime?      @map("deleted_at")
    createdAt          DateTime       @default(now()) @map("created_at")
    updatedAt          DateTime       @updatedAt @map("updated_at")

    user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    product Product? @relation(fields: [reviewableId], references: [id], map: "review_product_fk")
    service Service? @relation(fields: [reviewableId], references: [id], map: "review_service_fk")
    shop    Shop?    @relation(fields: [reviewableId], references: [id], map: "review_shop_fk")

    @@map("reviews")
}

// Comment Model
model Comment {
    id               String          @id @default(uuid())
    userId           String          @map("user_id")
    commentableType  CommentableType @map("commentable_type")
    commentableId    String          @map("commentable_id")
    parentCommentId  String?         @map("parent_comment_id")
    content          String
    isEdited         Boolean         @default(false) @map("is_edited")
    isDeletedByAdmin Boolean         @default(false) @map("is_deleted_by_admin")
    deletedReason    String?         @map("deleted_reason")
    deletedAt        DateTime?       @map("deleted_at")
    createdAt        DateTime        @default(now()) @map("created_at")
    updatedAt        DateTime        @updatedAt @map("updated_at")

    user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
    post          Post?     @relation(fields: [commentableId], references: [id], map: "comment_post_fk")
    product       Product?  @relation(fields: [commentableId], references: [id], map: "comment_product_fk")
    service       Service?  @relation(fields: [commentableId], references: [id], map: "comment_service_fk")
    parentComment Comment?  @relation("CommentReplies", fields: [parentCommentId], references: [id])
    replies       Comment[] @relation("CommentReplies")

    @@map("comments")
}
