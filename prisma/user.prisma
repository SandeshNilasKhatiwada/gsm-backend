// User Model
model User {
    id                String    @id @default(uuid())
    email             String    @unique
    username          String    @unique
    passwordHash      String    @map("password_hash")
    firstName         String?   @map("first_name")
    lastName          String?   @map("last_name")
    phoneNumber       String?   @map("phone_number")
    profilePictureUrl String?   @map("profile_picture_url")
    isVerified        Boolean   @default(false) @map("is_verified")
    isActive          Boolean   @default(true) @map("is_active")
    isBlocked         Boolean   @default(false) @map("is_blocked")
    blockedReason     String?   @map("blocked_reason")
    warningCount      Int       @default(0) @map("warning_count")
    lastWarningAt     DateTime? @map("last_warning_at")
    emailVerifiedAt   DateTime? @map("email_verified_at")
    deletedAt         DateTime? @map("deleted_at")
    createdAt         DateTime  @default(now()) @map("created_at")
    updatedAt         DateTime  @updatedAt @map("updated_at")

    roles          UserRole[]
    ownedShops     Shop[]         @relation("ShopOwner")
    staffShops     ShopStaff[]
    reviews        Review[]
    comments       Comment[]
    followedShops  ShopFollower[]
    orders         Order[]
    warnings       UserWarning[]  @relation("UserWarnings")
    issuedWarnings UserWarning[]  @relation("IssuedWarnings")
    activityLogs   ActivityLog[]
    verifiedShops  Shop[]         @relation("ShopVerifier")
    reviewedRoles  UserRole[]     @relation("RoleReviewer")
    issuedStrikes  ShopStrike[]
    posts          Post[]
    products       Product[]
    services       Service[]

    @@map("users")
}

// Role Model
model Role {
    id           String    @id @default(uuid())
    name         String    @unique
    description  String?
    isSystemRole Boolean   @default(false) @map("is_system_role")
    createdAt    DateTime  @default(now()) @map("created_at")
    updatedAt    DateTime  @updatedAt @map("updated_at")
    deletedAt    DateTime? @map("deleted_at")

    permissions RolePermission[]
    users       UserRole[]

    @@map("roles")
}

// Permission Model
model Permission {
    id          String    @id @default(uuid())
    name        String    @unique
    resource    String
    action      String
    description String?
    createdAt   DateTime  @default(now()) @map("created_at")
    updatedAt   DateTime  @updatedAt @map("updated_at")
    deletedAt   DateTime? @map("deleted_at")

    roles RolePermission[]

    @@map("permissions")
}

// RolePermission Junction Table
model RolePermission {
    id           String   @id @default(uuid())
    roleId       String   @map("role_id")
    permissionId String   @map("permission_id")
    createdAt    DateTime @default(now()) @map("created_at")

    role       Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)
    permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

    @@unique([roleId, permissionId])
    @@map("role_permissions")
}

// UserRole Junction Table
model UserRole {
    id              String         @id @default(uuid())
    userId          String         @map("user_id")
    roleId          String         @map("role_id")
    status          UserRoleStatus @default(pending)
    requestedAt     DateTime       @default(now()) @map("requested_at")
    reviewedAt      DateTime?      @map("reviewed_at")
    reviewedBy      String?        @map("reviewed_by")
    rejectionReason String?        @map("rejection_reason")
    createdAt       DateTime       @default(now()) @map("created_at")
    updatedAt       DateTime       @updatedAt @map("updated_at")

    user     User  @relation(fields: [userId], references: [id], onDelete: Cascade)
    role     Role  @relation(fields: [roleId], references: [id], onDelete: Cascade)
    reviewer User? @relation("RoleReviewer", fields: [reviewedBy], references: [id])

    @@unique([userId, roleId])
    @@map("user_roles")
}

// UserWarning Model
model UserWarning {
    id        String              @id @default(uuid())
    userId    String              @map("user_id")
    issuedBy  String              @map("issued_by")
    reason    String
    severity  UserWarningSeverity
    createdAt DateTime            @default(now()) @map("created_at")

    user   User @relation("UserWarnings", fields: [userId], references: [id], onDelete: Cascade)
    issuer User @relation("IssuedWarnings", fields: [issuedBy], references: [id])

    @@map("user_warnings")
}

// ActivityLog Model
model ActivityLog {
    id         String   @id @default(uuid())
    userId     String   @map("user_id")
    action     String
    entityType String   @map("entity_type")
    entityId   String   @map("entity_id")
    metadata   Json?
    ipAddress  String?  @map("ip_address")
    createdAt  DateTime @default(now()) @map("created_at")

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@map("activity_logs")
}
